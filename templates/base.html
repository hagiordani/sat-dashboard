<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ app_name }} - {{ now.strftime('%Y-%m-%d') }}</title>
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">

  <style>
    .logo-svg {
      height: 56px;
      width: auto;
    }
  </style>
</head>

<body>

<!-- ✅ NAVBAR CON LOGO SVG INLINE -->
<nav class="navbar navbar-dark bg-dark">
  <div class="container-fluid justify-content-center py-1">
    <a href="/" class="navbar-brand d-flex flex-column align-items-center">

      <!-- SVG INLINE (oscuro por defecto) -->
      <svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" id="satLogo">
        <rect width="64" height="64" rx="10" fill="#1C1C1C"/>
        <path d="M20 20h24v4H20zM20 30h24v4H20zM20 40h24v4H20z" fill="#00AEEF"/>
      </svg>

      <span class="text-white fw-bold fs-5">SAT Dashboard</span>
    </a>
  </div>
</nav>

<!-- ✅ TOP BAR -->
<div class="topbar d-flex align-items-center justify-content-between px-4 shadow-sm" style="height:48px;">
  <div class="topbar-left">
    <span class="topbar-title">
      Contribuyentes Publicados por el SAT (Art. 69-B CFF)
    </span>
  </div>

  <div class="topbar-right d-flex align-items-center gap-4">

    <a class="menu-link" href="/search">Buscar</a>
    <a class="menu-link" href="/tablas">Tablas</a>
    <a class="menu-link" href="/estadisticas">Estadísticas</a>
    <a class="menu-link" href="/carga_csv">Carga CSV</a>
    <a class="menu-link" href="/carga_masiva">Consulta RFCs</a>
    <a class="menu-link" href="/historial_cargas">Historial</a>

    <!-- ✅ NUEVO MENÚ BACKUPS -->
    <a class="menu-link" href="/backups">
      <i class="bi bi-hdd-stack"></i> Backups
    </a>

    <label class="theme-switch">
      <input type="checkbox" id="themeToggle">
      <span class="slider"></span>
    </label>
  </div>
</div>

<!-- ✅ CONTENIDO -->
<div class="container-fluid px-4 mt-4 mb-5">
  {% block content %}{% endblock %}
</div>

<!-- ✅ FOOTER -->
<footer class="text-center py-3 mt-4">
  Sistema SAT © {{ now.year }} — Desarrollado para uso interno
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- ✅ MODO OSCURO + CAMBIO DE LOGO INLINE -->
<script>
  window.addEventListener('DOMContentLoaded', () => {
    const toggle = document.getElementById('themeToggle');
    const logo = document.getElementById('satLogo');

    function loadDarkCSS() {
      if (!document.getElementById('darkCSS')) {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = "{{ url_for('static', filename='css/dark.css') }}";
        link.id = 'darkCSS';
        document.head.appendChild(link);
      }
    }

    function removeDarkCSS() {
      const darkLink = document.getElementById('darkCSS');
      if (darkLink) darkLink.remove();
    }

    const savedTheme = localStorage.getItem('theme') || 'light';

    function applyTheme(theme) {
      if (theme === 'dark') {
        document.body.classList.add('dark-mode');
        loadDarkCSS();
        if (logo) {
          logo.querySelector('rect').setAttribute('fill', '#ffffff');
          logo.querySelector('path').setAttribute('fill', '#00AEEF');
        }
      } else {
        document.body.classList.remove('dark-mode');
        removeDarkCSS();
        if (logo) {
          logo.querySelector('rect').setAttribute('fill', '#1C1C1C');
          logo.querySelector('path').setAttribute('fill', '#00AEEF');
        }
      }
    }

    applyTheme(savedTheme);

    toggle.checked = savedTheme === 'dark';

    toggle.addEventListener('change', () => {
      const newTheme = toggle.checked ? 'dark' : 'light';
      localStorage.setItem('theme', newTheme);
      applyTheme(newTheme);
    });
  });
</script>

{% block scripts %}{% endblock %}

</body>
</html>
