{% extends "base.html" %}
{% block content %}

<h1 class="mb-4">Estadísticas Detalladas</h1>

<!-- ============================
     Totales por Tabla
============================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-primary text-white fw-bold">
    Totales por Tabla
  </div>
  <div class="card-body p-0">
    <table class="table table-striped table-hover mb-0">
      <thead class="table-dark">
        <tr>
          <th>Tabla</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for tabla, total in stats.items() %}
        <tr>
          <td>{{ tabla }}</td>
          <td>{{ total }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ============================
     Duplicados
============================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-danger text-white fw-bold">
    Duplicados por Tabla
  </div>
  <div class="card-body p-0">
    <table class="table table-striped table-hover mb-0">
      <thead class="table-dark">
        <tr>
          <th>Tabla</th>
          <th>Duplicados</th>
        </tr>
      </thead>
      <tbody>
        {% for tabla, total in duplicates.items() %}
        <tr>
          <td>{{ tabla }}</td>
          <td>{{ total }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ============================
     Situaciones 69-B
============================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-warning fw-bold">
    Situaciones del Artículo 69-B
  </div>
  <div class="card-body p-0">
    <table class="table table-striped table-hover mb-0">
      <thead class="table-dark">
        <tr>
          <th>Situación</th>
          <th>Cantidad</th>
        </tr>
      </thead>
      <tbody>
        {% for s in situaciones %}
        <tr>
          <td>{{ s.situacion_contribuyente }}</td>
          <td>{{ s.count }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ============================
     Últimas Actualizaciones
============================= -->
<div class="card shadow-sm mb-4">
  <div class="card-header bg-info text-white fw-bold">
    Últimas Actualizaciones
  </div>
  <div class="card-body p-0">
    <table class="table table-striped table-hover mb-0">
      <thead class="table-dark">
        <tr>
          <th>Tabla</th>
          <th>Fecha</th>
          <th>Registros</th>
        </tr>
      </thead>
      <tbody>
        {% for u in actualizaciones %}
        <tr>
          <td>{{ u.table_name }}</td>
          <td>
            {% if u.ultima_actualizacion %}
              {{ u.ultima_actualizacion.strftime('%d/%m/%Y') }}
            {% else %}
              <em>Sin fecha</em>
            {% endif %}
          </td>
          <td>{{ u.total_registros }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ============================
     Texto legal general
============================= -->
{% if texto_legal %}
<div class="alert alert-secondary mt-4 shadow-sm">
  <h5 class="fw-bold">Información oficial del SAT</h5>
  <p style="white-space: pre-line;">{{ texto_legal }}</p>
</div>
{% endif %}

<!-- ============================
     Texto legal por tabla
============================= -->
<h3 class="mt-5 mb-3">Información legal por tabla</h3>

{% for t in textos_legales %}
<div class="card shadow-sm mb-3">
  <div class="card-header bg-dark text-white fw-bold">
    {{ t.tabla }}
  </div>
  <div class="card-body">
    <p style="white-space: pre-line;">
      {{ t.linea1 }}

      {{ t.linea2 }}
    </p>
  </div>
</div>
{% endfor %}

{% endblock %}
